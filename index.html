<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark" />
  <meta name="google-site-verification" content="L1aS8txxzlMjDV_Efl0Oi1WDR0J7_DCdyazGjG1zVPk" />
  <meta name="description" content="Renette — портал пресета SillyTavern: промпт‑лаборатория, гайды, копирование, и пасхалка‑игра." />

  <title>Renette Preset Portal</title>

  <style>
    :root{
      --bg0:#0f131a;
      --bg1:#121a22;
      --bg2:#0f1820;
      --card:#0f1620cc;
      --stroke:rgba(190, 255, 240, .14);
      --stroke2:rgba(140, 170, 255, .14);

      --mint:#7fffe1;
      --mint2:#3ee7c2;
      --red:#ff3b6c;
      --red2:#ff6a8f;
      --blue:#6aa6ff;
      --blue2:#4f79ff;

      --text:#e7edf7;
      --muted:#a9b6cc;

      --shadow: 0 18px 70px rgba(0,0,0,.55);
      --r12: 12px;
      --r16: 16px;
      --r20: 20px;

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      background:
        radial-gradient(1200px 700px at 20% -10%, rgba(127,255,225,.20), transparent 60%),
        radial-gradient(1000px 700px at 90% 0%, rgba(106,166,255,.18), transparent 55%),
        radial-gradient(800px 600px at 70% 120%, rgba(255,59,108,.16), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg0));
      color:var(--text);
      overflow-x:hidden;
    }

    /* Subtle animated tech grain */
    .grain{
      position:fixed; inset:-40%;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='260' height='260'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='260' height='260' filter='url(%23n)' opacity='.55'/%3E%3C/svg%3E");
      mix-blend-mode:overlay;
      opacity:.075;
      pointer-events:none;
      transform:translateZ(0);
      animation:grainMove 10s linear infinite;
    }
    @keyframes grainMove{
      0%{transform:translate3d(-2%, -2%, 0) scale(1.02)}
      50%{transform:translate3d(2%, 1%, 0) scale(1.02)}
      100%{transform:translate3d(-2%, -2%, 0) scale(1.02)}
    }

    a{color:inherit; text-decoration:none}
    .wrap{max-width:1200px; margin:0 auto; padding:20px}
    .topbar{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(14px);
      background: linear-gradient(180deg, rgba(18,26,34,.78), rgba(18,26,34,.35));
      border-bottom: 1px solid rgba(190,255,240,.12);
    }
    .topbar-inner{
      display:flex; align-items:center; justify-content:space-between;
      gap:14px; padding:12px 20px; max-width:1200px; margin:0 auto;
    }

    .brand{
      display:flex; align-items:center; gap:12px; min-width: 250px;
    }
    .sigil{
      width:40px; height:40px; border-radius:14px;
      background:
        radial-gradient(14px 14px at 30% 30%, rgba(127,255,225,.85), transparent 60%),
        radial-gradient(18px 18px at 70% 70%, rgba(255,59,108,.65), transparent 65%),
        radial-gradient(30px 30px at 60% 30%, rgba(106,166,255,.55), transparent 70%),
        linear-gradient(145deg, rgba(20,28,38,.95), rgba(10,14,20,.55));
      border: 1px solid rgba(190,255,240,.18);
      box-shadow: 0 12px 50px rgba(0,0,0,.45);
      position:relative;
      overflow:hidden;
    }
    .sigil:before{
      content:"";
      position:absolute; inset:-60%;
      background: conic-gradient(from 0deg, rgba(127,255,225,.0), rgba(127,255,225,.18), rgba(106,166,255,.0), rgba(255,59,108,.16), rgba(127,255,225,.0));
      animation:spin 7s linear infinite;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
    .brand h1{
      font-size:14px; margin:0; letter-spacing:.32px;
    }
    .brand p{margin:0; font-size:12px; color:var(--muted)}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      font-size:12px; color:rgba(231,237,247,.9);
      padding:8px 10px; border-radius:999px;
      border:1px solid rgba(190,255,240,.16);
      background:rgba(15,22,32,.55);
    }
    .pill b{font-weight:600}
    .nav{
      display:flex; align-items:center; gap:8px; flex-wrap:wrap; justify-content:flex-end;
    }
    .nav a{
      font-size:12px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid transparent;
      color:rgba(231,237,247,.88);
      background:rgba(15,22,32,.0);
      transition:.18s ease;
    }
    .nav a:hover{
      border-color:rgba(190,255,240,.16);
      background:rgba(15,22,32,.55);
      transform:translateY(-1px);
    }

    /* Hero */
    .hero{
      padding:22px 0 8px;
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:18px;
      align-items:stretch;
    }
    .hero-card{
      border-radius: var(--r20);
      background: linear-gradient(180deg, rgba(15,22,32,.82), rgba(15,22,32,.55));
      border:1px solid rgba(190,255,240,.14);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
      min-height: 310px;
    }
    .hero-card:before{
      content:"";
      position:absolute; inset:-1px;
      background:
        radial-gradient(900px 300px at 20% 0%, rgba(127,255,225,.16), transparent 60%),
        radial-gradient(700px 300px at 100% 20%, rgba(106,166,255,.14), transparent 60%),
        radial-gradient(600px 260px at 50% 100%, rgba(255,59,108,.12), transparent 60%);
      pointer-events:none;
    }

    .hero-left{padding:18px 18px 16px; position:relative}
    .kicker{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      margin-bottom:10px;
    }
    .kicker .tag{
      font-size:12px;
      padding:7px 10px;
      border-radius:999px;
      background:rgba(18,26,34,.7);
      border:1px solid rgba(190,255,240,.12);
      color:rgba(231,237,247,.9);
    }
    .kicker .tag i{font-style:normal; color:var(--mint)}
    .title{
      margin:0 0 10px;
      font-weight:750;
      letter-spacing:.2px;
      line-height:1.05;
      font-size: clamp(26px, 3.4vw, 40px);
    }
    .title .mint{color:var(--mint)}
    .title .red{color:var(--red)}
    .title .blue{color:var(--blue)}
    .sub{
      margin:0 0 14px;
      color:rgba(231,237,247,.86);
      font-size:14px;
      line-height:1.5;
      max-width: 62ch;
    }

    .cta-row{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      margin-top: 8px;
    }
    .btn{
      appearance:none; border:0;
      cursor:pointer;
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      padding:10px 12px;
      border-radius: 12px;
      font-size:13px;
      font-weight:650;
      letter-spacing:.18px;
      background: rgba(18,26,34,.70);
      color:rgba(231,237,247,.92);
      border:1px solid rgba(190,255,240,.14);
      transition: .18s ease;
      user-select:none;
    }
    .btn:hover{transform:translateY(-1px); border-color:rgba(127,255,225,.24)}
    .btn:active{transform:translateY(0px)}
    .btn.primary{
      background:
        radial-gradient(120px 80px at 20% 10%, rgba(127,255,225,.35), transparent 60%),
        radial-gradient(120px 80px at 80% 30%, rgba(106,166,255,.20), transparent 60%),
        linear-gradient(180deg, rgba(20,30,40,.85), rgba(15,22,32,.55));
    }
    .btn.danger{
      border-color: rgba(255,59,108,.28);
      background:
        radial-gradient(120px 80px at 20% 10%, rgba(255,59,108,.28), transparent 60%),
        linear-gradient(180deg, rgba(20,30,40,.85), rgba(15,22,32,.55));
    }
    .btn .dot{
      width:9px; height:9px; border-radius: 50%;
      background: var(--mint);
      box-shadow: 0 0 0 4px rgba(127,255,225,.12);
    }

    /* Mascot cover */
    .cover{
      position:relative;
      display:grid;
      grid-template-rows: auto 1fr;
    }
    .cover-head{
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 14px 10px;
      position:relative;
      border-bottom:1px solid rgba(190,255,240,.12);
    }
    .cover-head .label{
      font-size:12px; color:rgba(231,237,247,.86);
      display:flex; align-items:center; gap:10px;
    }
    .cover-head .label .chip{
      padding:6px 10px; border-radius: 999px;
      border:1px solid rgba(106,166,255,.18);
      background: rgba(15,22,32,.45);
      color: rgba(231,237,247,.9);
    }
    .cover-body{padding:14px; position:relative; overflow:hidden}
    .portrait{
      height:100%;
      border-radius: 18px;
      border:1px solid rgba(190,255,240,.14);
      background:
        radial-gradient(300px 200px at 30% 20%, rgba(127,255,225,.16), transparent 60%),
        radial-gradient(300px 200px at 80% 20%, rgba(106,166,255,.14), transparent 60%),
        radial-gradient(300px 200px at 40% 90%, rgba(255,59,108,.14), transparent 60%),
        linear-gradient(180deg, rgba(12,16,22,.55), rgba(12,16,22,.35));
      position:relative;
      overflow:hidden;
      min-height: 250px;
    }
    .portrait .scanline{
      position:absolute; inset:0;
      background:
        linear-gradient(180deg, transparent, rgba(127,255,225,.07), transparent),
        repeating-linear-gradient(180deg, rgba(255,255,255,.06) 0px, rgba(255,255,255,.06) 1px, transparent 1px, transparent 7px);
      opacity:.22;
      mix-blend-mode:overlay;
      animation:scan 6.5s linear infinite;
      pointer-events:none;
    }
    @keyframes scan{
      0%{transform:translateY(-25%)}
      100%{transform:translateY(25%)}
    }

    .portrait .mask{
      position:absolute; inset:0;
      display:grid;
      grid-template-columns: 1fr;
      place-items:end start;
      padding:14px;
    }

    .mascot-card{
      width:min(340px, 100%);
      border-radius: 16px;
      border:1px solid rgba(190,255,240,.14);
      background: rgba(15,22,32,.55);
      backdrop-filter: blur(10px);
      box-shadow: 0 18px 70px rgba(0,0,0,.35);
      padding:12px 12px 11px;
    }
    .mascot-card h3{
      margin:0 0 6px; font-size:14px; letter-spacing:.18px;
    }
    .mascot-card p{
      margin:0;
      color:rgba(231,237,247,.84);
      font-size:12px; line-height:1.45;
    }
    .mascot-card .legend{
      margin-top:10px;
      display:flex; gap:8px; flex-wrap:wrap;
      font-size:11px; color:rgba(231,237,247,.78);
    }
    .legend span{
      padding:6px 9px; border-radius:999px;
      border:1px solid rgba(190,255,240,.12);
      background: rgba(18,26,34,.55);
    }
    .legend .m{border-color: rgba(127,255,225,.18)}
    .legend .r{border-color: rgba(255,59,108,.20)}
    .legend .b{border-color: rgba(106,166,255,.20)}

    /* Content grid */
    .grid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:18px;
      margin:14px 0 34px;
    }

    .panel{
      border-radius: var(--r20);
      background: linear-gradient(180deg, rgba(15,22,32,.82), rgba(15,22,32,.55));
      border:1px solid rgba(190,255,240,.14);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .panel-head{
      display:flex; align-items:flex-end; justify-content:space-between;
      gap:12px;
      padding:14px 14px 12px;
      border-bottom: 1px solid rgba(190,255,240,.12);
    }
    .panel-head h2{
      margin:0;
      font-size:14px;
      letter-spacing:.2px;
    }
    .panel-head p{
      margin:4px 0 0;
      font-size:12px;
      color:rgba(231,237,247,.78);
    }
    .panel-body{padding:14px}

    /* Lab tabs */
    .lab-tabs{
      display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;
    }
    .seg{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(190,255,240,.12);
      background: rgba(18,26,34,.52);
      cursor:pointer;
      user-select:none;
      font-size:12px;
      color:rgba(231,237,247,.85);
      transition:.16s ease;
    }
    .seg[aria-selected="true"]{
      border-color: rgba(127,255,225,.28);
      box-shadow: 0 0 0 4px rgba(127,255,225,.08);
      transform: translateY(-1px);
    }

    .lab{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    .toggle-row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .toggle{
      border-radius: 16px;
      border:1px solid rgba(190,255,240,.12);
      background: rgba(12,16,22,.25);
      overflow:hidden;
      position:relative;
    }
    .toggle .t-head{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
      padding:12px 12px 10px;
      border-bottom:1px solid rgba(190,255,240,.10);
    }
    .toggle .t-title{
      display:flex; flex-direction:column; gap:4px;
      min-width:0;
    }
    .toggle .t-title b{
      font-size:13px;
      letter-spacing:.15px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .toggle .t-title small{
      color:rgba(231,237,247,.72);
      font-size:11px;
      line-height:1.2;
    }
    .toggle .t-actions{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end}
    .iconbtn{
      width:36px; height:36px;
      display:inline-grid; place-items:center;
      border-radius: 12px;
      border:1px solid rgba(190,255,240,.12);
      background: rgba(15,22,32,.55);
      cursor:pointer;
      transition:.16s ease;
      user-select:none;
    }
    .iconbtn:hover{transform:translateY(-1px); border-color:rgba(127,255,225,.20)}
    .icon{
      width:18px; height:18px; opacity:.92;
      background: radial-gradient(circle at 30% 30%, rgba(127,255,225,.9), rgba(106,166,255,.65));
      -webkit-mask: var(--mask) center / contain no-repeat;
      mask: var(--mask) center / contain no-repeat;
    }
    .m-copy{ --mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='black' d='M16 1H4a2 2 0 0 0-2 2v14h2V3h12V1Zm4 4H8a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2Zm0 18H8V7h12v16Z'/%3E%3C/svg%3E");}
    .m-open{ --mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='black' d='M14 3h7v7h-2V6.41l-9.29 9.3-1.42-1.42 9.3-9.29H14V3ZM5 5h6v2H7v10h10v-4h2v6H5V5Z'/%3E%3C/svg%3E");}
    .m-img{ --mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='black' d='M21 19V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2ZM8.5 11.5 11 14l2.5-3L17 16H7l1.5-4.5ZM8 9a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z'/%3E%3C/svg%3E");}

    .toggle .t-body{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:10px;
      padding:12px;
    }
    .field{
      border-radius: 14px;
      border:1px solid rgba(190,255,240,.12);
      background: rgba(15,22,32,.38);
      overflow:hidden;
    }
    .field label{
      display:flex; align-items:center; justify-content:space-between;
      padding:10px 10px 8px;
      border-bottom:1px solid rgba(190,255,240,.10);
      font-size:11px;
      color:rgba(231,237,247,.76);
    }
    textarea, input[type="text"]{
      width:100%;
      border:0;
      background:transparent;
      color:rgba(231,237,247,.92);
      font-family:var(--mono);
      font-size:12px;
      line-height:1.45;
      padding:10px;
      outline:none;
    }
    textarea{min-height:120px; resize:vertical}
    .preview{
      border-radius: 14px;
      border:1px solid rgba(106,166,255,.14);
      background: rgba(12,16,22,.25);
      overflow:hidden;
      position:relative;
    }
    .preview .ph{
      width:100%;
      height:100%;
      min-height: 196px;
      display:grid;
      place-items:center;
      color: rgba(231,237,247,.72);
      font-size:12px;
      text-align:center;
      padding:14px;
    }
    .preview img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:none;
      filter: saturate(1.05) contrast(1.04);
    }
    .preview .hint{
      position:absolute; left:10px; top:10px;
      font-size:11px;
      padding:6px 9px;
      border-radius:999px;
      border:1px solid rgba(190,255,240,.14);
      background: rgba(15,22,32,.55);
      color: rgba(231,237,247,.82);
      backdrop-filter: blur(8px);
    }

    /* Guides */
    .caps{
      display:grid;
      gap:10px;
    }
    .cap{
      border-radius: 18px;
      border:1px solid rgba(190,255,240,.12);
      background: rgba(12,16,22,.22);
      overflow:hidden;
    }
    .cap summary{
      list-style:none;
      cursor:pointer;
      padding:12px 12px 10px;
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
      user-select:none;
      outline:none;
    }
    .cap summary::-webkit-details-marker{display:none}
    .cap .cap-title{
      display:flex; flex-direction:column; gap:4px; min-width:0;
    }
    .cap .cap-title b{
      font-size:13px; letter-spacing:.15px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .cap .cap-title small{
      font-size:11px; color:rgba(231,237,247,.72);
      line-height:1.2;
    }
    .cap .cap-tools{
      display:flex; gap:8px; align-items:center;
    }
    .tick{
      width:38px; height:38px;
      border-radius: 12px;
      border:1px solid rgba(190,255,240,.12);
      background: rgba(15,22,32,.55);
      display:grid; place-items:center;
      cursor:pointer;
      transition:.16s ease;
      user-select:none;
      position:relative;
    }
    .tick input{position:absolute; inset:0; opacity:0; cursor:pointer}
    .tick .mark{
      width:18px; height:18px; border-radius: 6px;
      border:1px solid rgba(190,255,240,.18);
      background: rgba(12,16,22,.35);
      box-shadow: inset 0 0 0 0 rgba(127,255,225,.0);
      transition:.16s ease;
    }
    .tick input:checked + .mark{
      border-color: rgba(127,255,225,.35);
      box-shadow: inset 0 0 0 9px rgba(127,255,225,.18);
      background: rgba(127,255,225,.12);
    }
    .cap .cap-body{
      padding:0 12px 12px;
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:10px;
    }

    /* Utility box */
    .utility{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;
      margin-top:12px;
      padding:12px;
      border-radius: 18px;
      border:1px solid rgba(190,255,240,.12);
      background: rgba(12,16,22,.22);
    }
    .utility .left, .utility .right{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .kbd{
      font-family:var(--mono);
      font-size:11px;
      padding:6px 8px;
      border-radius: 10px;
      border:1px solid rgba(190,255,240,.12);
      background: rgba(15,22,32,.55);
      color: rgba(231,237,247,.84);
    }

    /* Toast */
    .toast{
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 16px;
      z-index: 999;
      background: rgba(15,22,32,.72);
      border:1px solid rgba(190,255,240,.16);
      backdrop-filter: blur(12px);
      padding:10px 12px;
      border-radius: 14px;
      box-shadow: 0 18px 70px rgba(0,0,0,.45);
      display:flex; align-items:center; gap:10px;
      opacity:0;
      pointer-events:none;
      transition:.22s ease;
      max-width: min(520px, calc(100vw - 24px));
    }
    .toast.show{opacity:1; pointer-events:auto}
    .toast .led{
      width:10px; height:10px; border-radius:50%;
      background: var(--mint);
      box-shadow: 0 0 0 4px rgba(127,255,225,.12), 0 0 18px rgba(127,255,225,.22);
    }
    .toast .msg{
      font-size:12px; color: rgba(231,237,247,.88);
      line-height:1.35;
    }

    /* Modal */
    .modal{
      position:fixed; inset:0;
      display:none;
      z-index: 200;
      background: rgba(6,10,14,.62);
      backdrop-filter: blur(14px);
      padding: 18px;
    }
    .modal.show{display:grid; place-items:center}
    .modal-card{
      width: min(980px, 100%);
      border-radius: 22px;
      border:1px solid rgba(190,255,240,.16);
      background:
        radial-gradient(900px 420px at 20% 0%, rgba(127,255,225,.12), transparent 60%),
        radial-gradient(900px 420px at 100% 20%, rgba(106,166,255,.12), transparent 60%),
        radial-gradient(900px 420px at 60% 120%, rgba(255,59,108,.11), transparent 60%),
        linear-gradient(180deg, rgba(15,22,32,.90), rgba(15,22,32,.62));
      box-shadow: 0 28px 120px rgba(0,0,0,.65);
      overflow:hidden;
    }
    .modal-head{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:14px 14px 12px;
      border-bottom:1px solid rgba(190,255,240,.12);
    }
    .modal-head h3{margin:0; font-size:14px; letter-spacing:.18px}
    .modal-head .x{
      width:42px; height:42px; border-radius: 14px;
      border:1px solid rgba(190,255,240,.14);
      background: rgba(15,22,32,.55);
      cursor:pointer;
      transition:.16s ease;
    }
    .modal-head .x:hover{transform:translateY(-1px); border-color:rgba(255,59,108,.25)}
    .modal-body{padding:14px}

    /* Game */
    .game{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    .gameTop{
      display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;
    }
    .hud{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      font-size:12px;
      color: rgba(231,237,247,.86);
    }
    .hud .stat{
      padding:7px 10px; border-radius: 999px;
      border:1px solid rgba(190,255,240,.14);
      background: rgba(15,22,32,.55);
      font-family: var(--mono);
    }
    .board{
      border-radius: 18px;
      border:1px solid rgba(190,255,240,.14);
      background: rgba(12,16,22,.25);
      overflow:hidden;
      position:relative;
    }
    .boardGrid{
      display:grid;
      grid-template-columns: repeat(6, 1fr);
      gap:10px;
      padding:14px;
    }
    .cell{
      aspect-ratio: 1 / 1;
      border-radius: 16px;
      border:1px solid rgba(190,255,240,.12);
      background:
        radial-gradient(120px 80px at 30% 20%, rgba(127,255,225,.10), transparent 60%),
        linear-gradient(180deg, rgba(15,22,32,.60), rgba(15,22,32,.30));
      cursor:pointer;
      transition: .14s ease;
      position:relative;
      overflow:hidden;
      user-select:none;
    }
    .cell:hover{transform:translateY(-1px); border-color:rgba(127,255,225,.20)}
    .cell:active{transform:translateY(0px)}
    .cell .glow{
      position:absolute; inset:-40%;
      background: conic-gradient(from 0deg, rgba(127,255,225,.0), rgba(127,255,225,.14), rgba(106,166,255,.0), rgba(255,59,108,.12), rgba(127,255,225,.0));
      opacity:0;
      transition:.18s ease;
      animation:spin 6s linear infinite;
      pointer-events:none;
    }
    .cell.revealed .glow{opacity:1}
    .cell .face{
      position:absolute; inset:0;
      display:grid; place-items:center;
      font-size:20px;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.5));
    }
    .cell .badge{
      position:absolute; left:10px; top:10px;
      font-family: var(--mono);
      font-size:10px;
      padding:5px 7px;
      border-radius:999px;
      border:1px solid rgba(190,255,240,.14);
      background: rgba(15,22,32,.55);
      color: rgba(231,237,247,.82);
      opacity:.0;
      transform: translateY(-3px);
      transition:.18s ease;
    }
    .cell.revealed .badge{opacity:.95; transform: translateY(0)}
    .gameNote{
      border-radius: 18px;
      border:1px solid rgba(190,255,240,.12);
      background: rgba(12,16,22,.22);
      padding:12px;
      font-size:12px;
      color: rgba(231,237,247,.82);
      line-height:1.45;
    }
    .gameNote b{color:rgba(231,237,247,.92)}
    .footer{
      padding: 18px 0 28px;
      color: rgba(231,237,247,.65);
      font-size:12px;
      display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap;
      border-top:1px solid rgba(190,255,240,.10);
      margin-top: 18px;
    }
    .footer a{color: rgba(127,255,225,.85)}
    .tiny{
      font-family:var(--mono);
      color: rgba(231,237,247,.62);
    }

    /* Responsive */
    @media (max-width: 980px){
      .hero{grid-template-columns: 1fr}
      .grid{grid-template-columns: 1fr}
      .toggle-row{grid-template-columns: 1fr}
      .toggle .t-body{grid-template-columns: 1fr}
      .cap .cap-body{grid-template-columns: 1fr}
      .boardGrid{grid-template-columns: repeat(5, 1fr)}
      .brand{min-width:0}
    }
    @media (max-width: 520px){
      .boardGrid{grid-template-columns: repeat(4, 1fr)}
      .nav{display:none}
      .pill{display:none}
    }

    /* Hidden easter trigger */
    .easter{
      position:absolute;
      right: 10px;
      bottom: 10px;
      width: 44px; height: 44px;
      border-radius: 16px;
      border:1px solid rgba(190,255,240,.10);
      background: rgba(15,22,32,.18);
      cursor:pointer;
      opacity:.06;
      transition:.18s ease;
      user-select:none;
    }
    .easter:hover{opacity:.22; transform:translateY(-1px)}
    .easter:active{transform:translateY(0)}
  </style>
</head>

<body>
  <div class="grain" aria-hidden="true"></div>

  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="sigil" aria-hidden="true"></div>
        <div>
          <h1>Renette Preset Portal</h1>
          <p>яблоня → сеть · промпты → гайды · копируй аккуратно</p>
        </div>
      </div>

      <div class="pill" title="Тема: тёмная, мятно‑красно‑синевая">
        <span class="dot" aria-hidden="true"></span>
        <b>Модульный</b> · быстрый · адаптивный
      </div>

      <nav class="nav" aria-label="Навигация">
        <a href="#lab">Промпт‑лаборатория</a>
        <a href="#guides">Гайды</a>
        <a href="#vault">Хранилище</a>
        <a href="#about">О Ренетт</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section class="hero" id="about">
      <div class="hero-card hero-left">
        <div class="kicker">
          <span class="tag"><i>Renette</i> · цифровой дух</span>
          <span class="tag">SillyTavern preset · сборка</span>
          <span class="tag">копирование без боли</span>
        </div>

        <h2 class="title">
          Пресет, где <span class="mint">мята</span> живёт рядом с <span class="red">яблоком</span> и <span class="blue">сетью</span>.
        </h2>

        <p class="sub">
          Ренетт раньше сидела в яблоне и слушала, как люди спорят о пустяках, а теперь живёт в интернете и слушает, как спорят о токенах.
          Поэтому здесь всё устроено так, чтобы быстро собирать промпты, прикручивать гайды, и не терять куски текста по вкладкам.
          Внизу есть пасхалка: маленькая игра про яблоки и память, у неё есть финал.
        </p>

        <div class="cta-row">
          <button class="btn primary" id="jumpLab"><span class="dot"></span>Открыть лабораторию</button>
          <button class="btn" id="copyAllSelected">Копировать выбранное</button>
          <button class="btn danger" id="openGame">Пасхалка</button>
        </div>
      </div>

      <div class="hero-card cover" aria-label="Обложка маскота">
        <div class="cover-head">
          <div class="label">
            <span class="chip">Обложка</span>
            <span>маскот: Ренетт</span>
          </div>
          <div class="label">
            <span class="chip">Apple x Net</span>
          </div>
        </div>

        <div class="cover-body">
          <div class="portrait" role="img" aria-label="Заглушка под арт Ренетт">
            <div class="scanline" aria-hidden="true"></div>

            <div class="mask">
              <div class="mascot-card">
                <h3>Ренетт</h3>
                <p>
                  Цифровой дух, который помнит древесный сок и сетевой трафик.
                  Ветки у Ренетт остались в привычках: всё раскладывать по узлам и связям.
                  Внутри пресета она не “милая”, а полезная, иногда упрямая.
                </p>
                <div class="legend">
                  <span class="m">мята</span>
                  <span class="r">яблоко</span>
                  <span class="b">сеть</span>
                </div>
              </div>
            </div>

            <!-- пасхалка-кнопка почти невидима -->
            <button class="easter" id="easterBtn" aria-label="..." title="..."></button>
          </div>
        </div>
      </div>
    </section>

    <section class="grid">
      <!-- LAB -->
      <div class="panel" id="lab">
        <div class="panel-head">
          <div>
            <h2>Промпт‑лаборатория</h2>
            <p>Выбирай тоги, добавляй/заменяй промпты, прикрепляй скрин, копируй одним кликом.</p>
          </div>
          <div class="lab-tabs" role="tablist" aria-label="Режимы лаборатории">
            <div class="seg" role="tab" tabindex="0" aria-selected="true" data-mode="replace">Замена</div>
            <div class="seg" role="tab" tabindex="-1" aria-selected="false" data-mode="append">Дополнение</div>
            <div class="seg" role="tab" tabindex="-1" aria-selected="false" data-mode="bundle">Пакет</div>
          </div>
        </div>

        <div class="panel-body">
          <div class="lab">
            <div class="toggle-row" id="toggles"></div>

            <div class="utility" id="labTools">
              <div class="left">
                <button class="btn" id="copyLab">Копировать из лаборатории</button>
                <button class="btn" id="resetLab">Сбросить поля</button>
              </div>
              <div class="right">
                <span class="kbd">Enter</span>
                <span style="color:rgba(231,237,247,.72); font-size:12px;">в полях можно вставлять текст, скрины — по URL</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- GUIDES -->
      <div class="panel" id="guides">
        <div class="panel-head">
          <div>
            <h2>Гайд‑капсулы</h2>
            <p>Несколько выбранных гайдов → копирование одним блоком. У каждого есть описание и скрин.</p>
          </div>
          <div class="lab-tabs">
            <button class="btn" id="copyGuides">Копировать выбранные гайды</button>
          </div>
        </div>

        <div class="panel-body">
          <div class="caps" id="caps"></div>

          <div class="utility">
            <div class="left">
              <button class="btn" id="selectAllGuides">Выбрать все</button>
              <button class="btn" id="clearAllGuides">Снять выбор</button>
            </div>
            <div class="right">
              <span class="tiny">Подсказка: выбранные капсулы отмечаются квадратом</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- VAULT -->
    <section class="panel" id="vault">
      <div class="panel-head">
        <div>
          <h2>Хранилище</h2>
          <p>Здесь собирается всё выбранное: лаборатория + гайды. Можно отдать себе как один текст.</p>
        </div>
        <div class="lab-tabs">
          <button class="btn primary" id="copyVault"><span class="dot"></span>Копировать хранилище</button>
          <button class="btn" id="clearVault">Очистить</button>
        </div>
      </div>
      <div class="panel-body">
        <div class="field">
          <label>
            <span>Собранный текст</span>
            <span class="tiny">форматируется аккуратно, без лишних надписей</span>
          </label>
          <textarea id="vaultText" spellcheck="false">[placeholder]</textarea>
        </div>
      </div>
    </section>

    <div class="footer">
      <div>
        <div>© Renette Preset Portal · GitHub Pages</div>
        <div style="margin-top:6px">Сделано так, чтобы не было похоже на “обычный сайт”.</div>
      </div>
      <div class="tiny">
        <div>Цвета: mint / red / blue · тёмная техно‑сетка</div>
        <div style="margin-top:6px">Пасхалка доступна через кнопку или “невидимый лист” на обложке</div>
      </div>
    </div>
  </main>

  <!-- Toast -->
  <div class="toast" id="toast" role="status" aria-live="polite">
    <div class="led" aria-hidden="true"></div>
    <div class="msg" id="toastMsg">...</div>
  </div>

  <!-- Modal (Game) -->
  <div class="modal" id="modal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-label="Пасхалка — игра">
      <div class="modal-head">
        <h3>Пасхалка: “Сад кеша”</h3>
        <button class="x" id="closeModal" aria-label="Закрыть"></button>
      </div>
      <div class="modal-body">
        <div class="game">
          <div class="gameTop">
            <div class="hud">
              <div class="stat" id="statSteps">ходы: 0/9</div>
              <div class="stat" id="statApples">яблоки: 0</div>
              <div class="stat" id="statRot">гниль: 0</div>
              <div class="stat" id="statSigils">сигилы: 0</div>
            </div>
            <div style="display:flex; gap:10px; flex-wrap:wrap">
              <button class="btn" id="newGame">Новая партия</button>
              <button class="btn primary" id="revealEnding"><span class="dot"></span>Забрать финал</button>
            </div>
          </div>

          <div class="board">
            <div class="boardGrid" id="board"></div>
          </div>

          <div class="gameNote" id="gameNote">
            <b>Правила.</b> У тебя ровно 9 ходов. На поле спрятаны яблоки, гниль и сигилы Ренетт.
            Яблоко даёт +1, гниль даёт +1 гнили, сигил даёт +1 сигил и очищает одну гниль, если она есть.
            Финал зависит не от очков, а от баланса: “сад” должен быть живым, а не сладким и гнилым одновременно.
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const $ = (q, el=document) => el.querySelector(q);
    const $$ = (q, el=document) => [...el.querySelectorAll(q)];

    const toast = $("#toast");
    const toastMsg = $("#toastMsg");
    let toastTimer = null;
    function showToast(msg){
      toastMsg.textContent = msg;
      toast.classList.add("show");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=> toast.classList.remove("show"), 2400);
    }

    async function copyText(text){
      try{
        await navigator.clipboard.writeText(text);
        showToast("Скопировано в буфер обмена.");
        return true;
      }catch(e){
        // fallback
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        ta.remove();
        showToast("Скопировано (fallback).");
        return true;
      }
    }

    function normalizeBlock(s){
      return (s || "").replace(/\r\n/g, "\n").trim();
    }

    /* ========= Data ========= */
    const TOGGLES = [
      {
        id: "core",
        title: "Ядро / Core",
        subtitle: "основной слой поведения и стиля",
        prompt: "[placeholder]",
        desc: "[placeholder описание]",
        img: "[placeholder_url_или_пусто]"
      },
      {
        id: "dialogue",
        title: "Диалоги",
        subtitle: "правила речи, кавычки, подача",
        prompt: "[placeholder]",
        desc: "[placeholder описание]",
        img: "[placeholder_url_или_пусто]"
      },
      {
        id: "html",
        title: "HTML‑визуалы",
        subtitle: "диагетические панели, карточки, блоки",
        prompt: "[placeholder]",
        desc: "[placeholder описание]",
        img: "[placeholder_url_или_пусто]"
      },
      {
        id: "pacing",
        title: "Темп отношений",
        subtitle: "slow burn и микрошаги",
        prompt: "[placeholder]",
        desc: "[placeholder описание]",
        img: "[placeholder_url_или_пусто]"
      }
    ];

    const GUIDES = [
      {
        id: "install",
        title: "Подключение пресета",
        subtitle: "как вставлять и не ломать",
        text: "[placeholder]",
        desc: "[placeholder описание гайда]",
        img: "[placeholder_url_или_пусто]"
      },
      {
        id: "toggles",
        title: "Работа с тогглами",
        subtitle: "как выбирать и комбинировать",
        text: "[placeholder]",
        desc: "[placeholder описание гайда]",
        img: "[placeholder_url_или_пусто]"
      },
      {
        id: "troubles",
        title: "Проблемы и симптомы",
        subtitle: "что делать, когда всё стало странным",
        text: "[placeholder]",
        desc: "[placeholder описание гайда]",
        img: "[placeholder_url_или_пусто]"
      },
      {
        id: "aesthetics",
        title: "Эстетика Ренетт",
        subtitle: "яблоня и сеть в одном голосе",
        text: "[placeholder]",
        desc: "[placeholder описание гайда]",
        img: "[placeholder_url_или_пусто]"
      }
    ];

    /* ========= Lab UI ========= */
    const togglesEl = $("#toggles");
    const vaultText = $("#vaultText");

    let labMode = "replace"; // replace | append | bundle

    function renderToggles(){
      togglesEl.innerHTML = TOGGLES.map(t => `
        <section class="toggle" data-id="${t.id}">
          <div class="t-head">
            <div class="t-title">
              <b>${escapeHtml(t.title)}</b>
              <small>${escapeHtml(t.subtitle)}</small>
            </div>
            <div class="t-actions">
              <button class="iconbtn" data-act="copy" title="Копировать промпт" aria-label="Копировать">
                <span class="icon m-copy" aria-hidden="true"></span>
              </button>
              <button class="iconbtn" data-act="focus" title="Фокус на промпте" aria-label="Фокус">
                <span class="icon m-open" aria-hidden="true"></span>
              </button>
            </div>
          </div>

          <div class="t-body">
            <div style="display:grid; gap:10px">
              <div class="field">
                <label>
                  <span>Описание</span>
                  <span class="tiny">${escapeHtml(t.id)}</span>
                </label>
                <input type="text" value="${escapeAttr(t.desc)}" data-field="desc" spellcheck="false" />
              </div>

              <div class="field">
                <label>
                  <span>Промпт</span>
                  <span class="tiny">[placeholder]</span>
                </label>
                <textarea data-field="prompt" spellcheck="false">${escapeHtml(t.prompt)}</textarea>
              </div>
            </div>

            <div class="preview">
              <div class="hint">Скрин (URL)</div>
              <div class="ph">Вставь URL в поле ниже.<br/>Картинка появится здесь.</div>
              <img alt="скрин" />
              <div class="field" style="margin:12px; border-radius:14px">
                <label>
                  <span>URL изображения</span>
                  <span class="tiny">png/jpg/webp</span>
                </label>
                <input type="text" value="${escapeAttr(t.img)}" data-field="img" placeholder="[placeholder_url_или_пусто]" spellcheck="false" />
              </div>
            </div>
          </div>
        </section>
      `).join("");

      // bind events
      $$(".toggle", togglesEl).forEach(card=>{
        const id = card.dataset.id;
        const model = TOGGLES.find(x => x.id === id);

        const imgEl = $("img", card);
        const phEl = $(".ph", card);

        function refreshPreview(){
          const url = (model.img || "").trim();
          if(url && !url.includes("[placeholder")){
            imgEl.src = url;
            imgEl.style.display = "block";
            phEl.style.display = "none";
          }else{
            imgEl.removeAttribute("src");
            imgEl.style.display = "none";
            phEl.style.display = "grid";
          }
        }
        refreshPreview();

        $$("[data-field]", card).forEach(inp=>{
          inp.addEventListener("input", ()=>{
            const f = inp.dataset.field;
            model[f] = inp.value;
            if(f === "img") refreshPreview();
          });
        });

        $$("[data-act]", card).forEach(btn=>{
          btn.addEventListener("click", ()=>{
            const act = btn.dataset.act;
            if(act === "copy"){
              const block = buildLabBlock([model]);
              copyText(block);
            }
            if(act === "focus"){
              const ta = $("textarea[data-field='prompt']", card);
              ta.focus();
              ta.setSelectionRange(0, ta.value.length);
            }
          });
        });
      });
    }

    function escapeHtml(s){
      return (s ?? "").replace(/[&<>"']/g, m => ({
        "&":"&","<":"<",">":">",'"':""","'":"'"
      }[m]));
    }
    function escapeAttr(s){
      return (s ?? "").replace(/"/g, """);
    }

    function buildLabBlock(items){
      // минимально-читабельный формат: без лишних заголовков, но с идентификатором тоггла
      const blocks = items.map(t=>{
        const desc = normalizeBlock(t.desc);
        const p = normalizeBlock(t.prompt);
        const img = (t.img || "").trim();

        const parts = [];
        parts.push(`[toggle:${t.id}]`);
        if(desc) parts.push(desc);
        if(img && !img.includes("[placeholder")) parts.push(`img: ${img}`);
        parts.push(p || "[placeholder]");

        return parts.join("\n");
      });

      // режимы: replace / append / bundle влияют на разделители
      if(labMode === "bundle") return blocks.join("\n\n---\n\n");
      return blocks.join("\n\n");
    }

    function buildGuidesBlock(selected){
      const blocks = selected.map(g=>{
        const desc = normalizeBlock(g.desc);
        const text = normalizeBlock(g.text);
        const img = (g.img || "").trim();

        const parts = [];
        parts.push(`[guide:${g.id}]`);
        if(desc) parts.push(desc);
        if(img && !img.includes("[placeholder")) parts.push(`img: ${img}`);
        parts.push(text || "[placeholder]");
        return parts.join("\n");
      });
      return blocks.join("\n\n---\n\n");
    }

    function appendToVault(block){
      const current = normalizeBlock(vaultText.value);
      const b = normalizeBlock(block);
      if(!b) return;

      if(!current || current === "[placeholder]"){
        vaultText.value = b;
        return;
      }
      vaultText.value = current + "\n\n" + b;
    }

    // Mode switch
    $$(".seg").forEach(seg=>{
      seg.addEventListener("click", ()=>{
        $$(".seg").forEach(s=>{
          s.setAttribute("aria-selected", "false");
          s.tabIndex = -1;
        });
        seg.setAttribute("aria-selected", "true");
        seg.tabIndex = 0;
        labMode = seg.dataset.mode;
        showToast("Режим лаборатории: " + (labMode === "replace" ? "Замена" : labMode === "append" ? "Дополнение" : "Пакет"));
      });
      seg.addEventListener("keydown", (e)=>{
        if(e.key === "Enter" || e.key === " "){
          e.preventDefault();
          seg.click();
        }
      });
    });

    // Lab buttons
    $("#copyLab").addEventListener("click", ()=>{
      const text = buildLabBlock(TOGGLES);
      copyText(text);
      appendToVault(text);
    });

    $("#resetLab").addEventListener("click", ()=>{
      TOGGLES.forEach(t=>{
        t.prompt = "[placeholder]";
        t.desc = "[placeholder описание]";
        t.img = "[placeholder_url_или_пусто]";
      });
      renderToggles();
      showToast("Поля лаборатории сброшены.");
    });

    $("#copyAllSelected").addEventListener("click", ()=>{
      const selectedGuides = GUIDES.filter(g => g._selected);
      const a = buildLabBlock(TOGGLES);
      const b = selectedGuides.length ? buildGuidesBlock(selectedGuides) : "";
      const pack = normalizeBlock([a,b].filter(Boolean).join("\n\n===\n\n"));
      copyText(pack);
      appendToVault(pack);
    });

    $("#jumpLab").addEventListener("click", ()=>{
      document.getElementById("lab").scrollIntoView({behavior:"smooth", block:"start"});
    });

    /* ========= Guides UI ========= */
    const capsEl = $("#caps");

    function renderGuides(){
      capsEl.innerHTML = GUIDES.map(g => `
        <details class="cap" data-id="${g.id}">
          <summary>
            <div class="cap-title">
              <b>${escapeHtml(g.title)}</b>
              <small>${escapeHtml(g.subtitle)}</small>
            </div>
            <div class="cap-tools">
              <label class="tick" title="Выбрать гайд">
                <input type="checkbox" ${g._selected ? "checked" : ""} />
                <span class="mark" aria-hidden="true"></span>
              </label>
              <button class="iconbtn" data-act="copy" title="Копировать только этот гайд" aria-label="Копировать гайд">
                <span class="icon m-copy" aria-hidden="true"></span>
              </button>
            </div>
          </summary>

          <div class="cap-body">
            <div style="display:grid; gap:10px">
              <div class="field">
                <label>
                  <span>Описание</span>
                  <span class="tiny">${escapeHtml(g.id)}</span>
                </label>
                <input type="text" value="${escapeAttr(g.desc)}" data-field="desc" spellcheck="false" />
              </div>

              <div class="field">
                <label>
                  <span>Текст гайда</span>
                  <span class="tiny">[placeholder]</span>
                </label>
                <textarea data-field="text" spellcheck="false">${escapeHtml(g.text)}</textarea>
              </div>
            </div>

            <div class="preview">
              <div class="hint">Скрин (URL)</div>
              <div class="ph">Сюда можно повесить скрин к гайду.<br/>Вставь URL в поле ниже.</div>
              <img alt="скрин" />
              <div class="field" style="margin:12px; border-radius:14px">
                <label>
                  <span>URL изображения</span>
                  <span class="tiny">png/jpg/webp</span>
                </label>
                <input type="text" value="${escapeAttr(g.img)}" data-field="img" placeholder="[placeholder_url_или_пусто]" spellcheck="false" />
              </div>
            </div>
          </div>
        </details>
      `).join("");

      $$(".cap", capsEl).forEach(cap=>{
        const id = cap.dataset.id;
        const model = GUIDES.find(x => x.id === id);

        const checkbox = $("input[type='checkbox']", cap);
        checkbox.addEventListener("change", ()=>{
          model._selected = checkbox.checked;
        });

        const imgEl = $("img", cap);
        const phEl = $(".ph", cap);

        function refreshPreview(){
          const url = (model.img || "").trim();
          if(url && !url.includes("[placeholder")){
            imgEl.src = url;
            imgEl.style.display = "block";
            phEl.style.display = "none";
          }else{
            imgEl.removeAttribute("src");
            imgEl.style.display = "none";
            phEl.style.display = "grid";
          }
        }
        refreshPreview();

        $$("[data-field]", cap).forEach(inp=>{
          inp.addEventListener("input", ()=>{
            model[inp.dataset.field] = inp.value;
            if(inp.dataset.field === "img") refreshPreview();
          });
        });

        $$(".iconbtn[data-act='copy']", cap).forEach(btn=>{
          btn.addEventListener("click", (e)=>{
            e.preventDefault();
            e.stopPropagation();
            const block = buildGuidesBlock([model]);
            copyText(block);
            appendToVault(block);
          });
        });
      });
    }

    $("#copyGuides").addEventListener("click", ()=>{
      const selected = GUIDES.filter(g => g._selected);
      if(!selected.length){
        showToast("Ничего не выбрано.");
        return;
      }
      const block = buildGuidesBlock(selected);
      copyText(block);
      appendToVault(block);
    });

    $("#selectAllGuides").addEventListener("click", ()=>{
      GUIDES.forEach(g=> g._selected = true);
      renderGuides();
      showToast("Выбраны все гайды.");
    });

    $("#clearAllGuides").addEventListener("click", ()=>{
      GUIDES.forEach(g=> g._selected = false);
      renderGuides();
      showToast("Выбор снят.");
    });

    /* ========= Vault ========= */
    $("#copyVault").addEventListener("click", ()=>{
      copyText(normalizeBlock(vaultText.value));
    });
    $("#clearVault").addEventListener("click", ()=>{
      vaultText.value = "[placeholder]";
      showToast("Хранилище очищено.");
    });

    /* ========= Easter / Game ========= */
    const modal = $("#modal");
    const openGame = () => {
      modal.classList.add("show");
      modal.setAttribute("aria-hidden", "false");
      startGame();
    };
    const closeGame = () => {
      modal.classList.remove("show");
      modal.setAttribute("aria-hidden", "true");
    };

    $("#openGame").addEventListener("click", openGame);
    $("#easterBtn").addEventListener("click", openGame);
    $("#closeModal").addEventListener("click", closeGame);
    modal.addEventListener("click", (e)=>{
      if(e.target === modal) closeGame();
    });
    document.addEventListener("keydown", (e)=>{
      if(e.key === "Escape" && modal.classList.contains("show")) closeGame();
    });

    const boardEl = $("#board");
    const statSteps = $("#statSteps");
    const statApples = $("#statApples");
    const statRot = $("#statRot");
    const statSigils = $("#statSigils");
    const gameNote = $("#gameNote");

    let G = null;

    function randInt(n){ return Math.floor(Math.random() * n); }
    function shuffle(a){
      for(let i=a.length-1;i>0;i--){
        const j = randInt(i+1);
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function startGame(){
      // 24 клетки: спрятано 8 яблок, 6 гнили, 4 сигила, остальное пусто
      const types = [];
      for(let i=0;i<8;i++) types.push("apple");
      for(let i=0;i<6;i++) types.push("rot");
      for(let i=0;i<4;i++) types.push("sigil");
      while(types.length < 24) types.push("empty");
      shuffle(types);

      G = {
        steps:0,
        maxSteps:9,
        apples:0,
        rot:0,
        sigils:0,
        cells: types.map((t, idx)=>({ id: idx, type: t, revealed:false }))
      };

      renderBoard();
      renderHUD();
      gameNote.innerHTML =
        "<b>Правила.</b> У тебя ровно 9 ходов. Яблоко +1, гниль +1 гнили, сигил +1 сигил и очищает одну гниль, если она есть. Финал зависит от баланса.";
    }

    function renderHUD(){
      statSteps.textContent = `ходы: ${G.steps}/${G.maxSteps}`;
      statApples.textContent = `яблоки: ${G.apples}`;
      statRot.textContent = `гниль: ${G.rot}`;
      statSigils.textContent = `сигилы: ${G.sigils}`;
    }

    function faceFor(type){
      if(type === "apple") return "🍎";
      if(type === "rot") return "⬛";
      if(type === "sigil") return "✦";
      return "·";
    }
    function badgeFor(type){
      if(type === "apple") return "apple";
      if(type === "rot") return "rot";
      if(type === "sigil") return "sigil";
      return "empty";
    }

    function renderBoard(){
      boardEl.innerHTML = "";
      G.cells.forEach(c=>{
        const cell = document.createElement("div");
        cell.className = "cell" + (c.revealed ? " revealed" : "");
        cell.setAttribute("role","button");
        cell.setAttribute("tabindex","0");
        cell.setAttribute("aria-label","клетка");

        const glow = document.createElement("div");
        glow.className = "glow";
        const badge = document.createElement("div");
        badge.className = "badge";
        badge.textContent = badgeFor(c.type);

        const face = document.createElement("div");
        face.className = "face";
        face.textContent = c.revealed ? faceFor(c.type) : " ";

        cell.append(glow, badge, face);

        const click = ()=>{
          if(G.steps >= G.maxSteps){
            showToast("Ходы закончились. Нажми “Забрать финал”.");
            return;
          }
          if(c.revealed){
            showToast("Эта клетка уже открыта.");
            return;
          }
          c.revealed = true;
          G.steps++;

          if(c.type === "apple"){
            G.apples++;
            showToast("Яблоко найдено.");
          }else if(c.type === "rot"){
            G.rot++;
            showToast("Гниль найдена.");
          }else if(c.type === "sigil"){
            G.sigils++;
            if(G.rot > 0) G.rot--;
            showToast("Сигил активирован.");
          }else{
            showToast("Пусто.");
          }

          renderBoard();
          renderHUD();

          if(G.steps >= G.maxSteps){
            gameNote.innerHTML =
              "<b>Ходы закончились.</b> Теперь важно, что ты вытащила из сада. Нажми “Забрать финал”.";
          }
        };

        cell.addEventListener("click", click);
        cell.addEventListener("keydown", (e)=>{
          if(e.key === "Enter" || e.key === " "){
            e.preventDefault();
            click();
          }
        });

        boardEl.appendChild(cell);
      });
    }

    function endingText(){
      // финал: не банально “больше очков”
      // баланс: яблоки должны быть > гнили, но гниль не должна быть 0 при высоких яблоках,
      // сигилы позволяют “сохранить память” (очистка), но если сигилов много и яблок мало — холодная сеть.
      const a = G.apples, r = G.rot, s = G.sigils;

      // Сценарные концовки: 4 шт.
      if(a >= 5 && r <= 1 && s >= 2){
        return "Финал: Сад работает тихо. Яблоки не сладкие, а живые. Ренетт не спорит и не шутит, потому что ей не надо доказывать, что она существует.";
      }
      if(a >= 4 && r >= 4){
        return "Финал: Сад красивый и испорченный. Яблоки есть, но гниль тоже есть. Ренетт говорит, что так обычно и бывает: если часто ускорять, дерево ломается внутри.";
      }
      if(s >= 4 && a <= 2){
        return "Финал: Сеть победила. Сигилы светятся, всё чисто, но яблоня почти пустая. Ренетт выглядит правильно и говорит правильно, и от этого становится неприятно.";
      }
      if(r >= 5){
        return "Финал: Гниль сильнее. Не потому что ты ошиблась, а потому что сад не любит спешку и азарт. Ренетт молчит и заново считает ветки.";
      }
      // нейтральный
      return "Финал: Сад получается обычным. Немного яблок, немного грязи, немного сети. Ренетт говорит, что обычное иногда лучше идеального, но видно, что она лукавит.";
    }

    $("#newGame").addEventListener("click", startGame);

    $("#revealEnding").addEventListener("click", ()=>{
      if(!G) return;
      if(G.steps < G.maxSteps){
        showToast("Можно, но лучше доиграть 9 ходов.");
      }
      gameNote.textContent = endingText();
    });

    /* init */
    renderToggles();
    renderGuides();
  </script>
</body>
</html>
