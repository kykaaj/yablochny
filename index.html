<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Renette: Project Apple | –Ø–±–ª–æ—á–Ω—ã–π –ü—Ä–µ—Å–µ—Ç</title>
    <meta name="description" content="–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Ö–∞–± –ø—Ä–µ—Å–µ—Ç–∞ '–Ø–±–ª–æ—á–Ω—ã–π' –¥–ª—è SillyTavern.">
    <meta name="google-site-verification" content="L1aS8txxzlMjDV_Efl0Oi1WDR0J7_DCdyazGjG1zVPk" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Space+Grotesk:wght@300;500;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg-deep: #121214;
            --bg-panel: #1c1c1f;
            --bg-card: #232326;

            --mint: #4fffa8;
            --mint-dim: rgba(79, 255, 168, 0.1);
            --apple-red: #ff4757;
            --lilac: #a29bfe;

            --text-main: #ececec;
            --text-muted: #888890;

            --radius-lg: 24px;
            --radius-sm: 12px;

            --grid-pattern: radial-gradient(#ffffff 1px, transparent 1px);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-deep);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* --- BACKGROUND & DECOR --- */
        #interactive-bg {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            opacity: 0.6;
        }

        .noise-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MDAiIGhlaWdodD0iNTAwIj48ZmlsdGVyIGlkPSJnoiPjxmZVR1cmJ1bGVuY2UgdHlwZT0iZnJhY3RhbE5vaXNlIiBiYXNlRnJlcXVlbmN5PSIwLjY1IiBudW1PY3RhdmVzPSIzIiBzdGl0Y2hUaWxlcz0ic3RpdGNoIi8+PC9maWx0ZXI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsdGVyPSJ1cmwoI2cpIiBvcGFjaXR5PSIwLjAzIi8+PC9zdmc+');
            pointer-events: none;
            z-index: 9999;
            opacity: 0.4;
        }

        /* --- LAYOUT UTILS --- */
        .container { max-width: 1440px; margin: 0 auto; padding: 0 40px; }
        .flex-row { display: flex; gap: 20px; align-items: center; }
        .flex-col { display: flex; flex-direction: column; gap: 20px; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .header-font { font-family: 'Space Grotesk', sans-serif; }

        .mint-text { color: var(--mint); }
        .red-text { color: var(--apple-red); }
        .lilac-text { color: var(--lilac); }

        /* --- HEADER REDESIGN --- */
        header {
            padding: 40px 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            align-items: center;
            margin-bottom: 80px;
            position: relative;
        }

        .brand-block h1 {
            font-size: clamp(3rem, 6vw, 5.5rem);
            line-height: 0.9;
            font-weight: 700;
            letter-spacing: -2px;
            margin-bottom: 20px;
            position: relative;
        }

        .brand-block h1 span { display: block; }
        .brand-decor {
            position: absolute;
            left: -60px; top: 20px;
            font-size: 10rem;
            opacity: 0.05;
            font-weight: 800;
            z-index: -1;
            color: var(--mint);
        }

        .header-nav {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .nav-pill {
            padding: 12px 24px;
            border-radius: 100px;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--text-main);
            text-decoration: none;
            font-weight: 500;
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-pill:hover {
            background: var(--mint);
            color: #000;
            border-color: var(--mint);
            transform: translateY(-2px);
        }

        .hero-widget {
            background: var(--bg-panel);
            padding: 30px;
            border-radius: var(--radius-lg);
            border: 1px solid rgba(255,255,255,0.05);
            position: relative;
            overflow: hidden;
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .hero-widget::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 4px;
            background: linear-gradient(90deg, var(--mint), var(--lilac));
        }

        .avatar-frame {
            width: 100px; height: 100px;
            border-radius: 50%;
            border: 2px dashed var(--mint);
            padding: 5px;
            flex-shrink: 0;
        }

        .avatar-frame img {
            width: 100%; height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        /* --- GUIDES (CAROUSEL STYLE) --- */
        .section-title {
            font-size: 2.5rem;
            margin-bottom: 40px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: end;
        }

        .guides-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 100px;
        }

        .guide-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 30px;
            position: relative;
            transition: 0.3s;
            border: 1px solid transparent;
            overflow: hidden;
        }

        .guide-card:hover {
            border-color: var(--lilac);
            transform: translateY(-5px);
        }

        .guide-icon {
            font-size: 2rem;
            margin-bottom: 20px;
            color: var(--lilac);
        }

        /* --- PROMPT BUILDER (NEW LOGIC) --- */
        .builder-layout {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 40px;
            margin-bottom: 100px;
        }

        /* Sidebar Navigation for Blocks */
        .builder-nav {
            position: sticky;
            top: 40px;
            background: var(--bg-panel);
            padding: 20px;
            border-radius: var(--radius-lg);
            border: 1px solid rgba(255,255,255,0.05);
            height: fit-content;
        }

        .block-link {
            display: block;
            padding: 15px;
            margin-bottom: 5px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            color: var(--text-muted);
            font-weight: 500;
            transition: 0.2s;
            border-left: 3px solid transparent;
        }

        .block-link:hover, .block-link.active {
            background: rgba(255,255,255,0.03);
            color: var(--text-main);
        }

        .block-link.active {
            border-left-color: var(--mint);
        }

        /* Content Area */
        .builder-content {
            display: flex;
            flex-direction: column;
            gap: 60px;
        }

        .prompt-block {
            scroll-margin-top: 40px;
        }

        .block-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
        }

        .block-num {
            font-size: 4rem;
            font-weight: 800;
            color: rgba(255,255,255,0.03);
            line-height: 1;
        }

        .sub-group {
            margin-bottom: 30px;
            background: rgba(0,0,0,0.2);
            padding: 20px;
            border-radius: var(--radius-sm);
            border-left: 2px solid var(--text-muted);
        }

        .sub-group-title {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--mint);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Option Cards (Radio & Checkbox) */
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }

        .option-label {
            display: flex;
            flex-direction: column;
            background: var(--bg-card);
            border: 1px solid rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: 0.2s;
            position: relative;
        }

        .option-label:hover { border-color: var(--text-muted); }

        /* Hide native inputs */
        .option-label input { position: absolute; opacity: 0; }

        /* Custom visual states */
        .option-label.checked {
            border-color: var(--mint);
            background: rgba(79, 255, 168, 0.05);
        }

        .option-label.checked .check-indicator {
            background: var(--mint);
            box-shadow: 0 0 10px var(--mint);
        }

        .check-indicator {
            width: 12px; height: 12px;
            border-radius: 50%;
            background: #444;
            margin-bottom: 10px;
            transition: 0.3s;
        }

        .opt-name { font-weight: 600; font-size: 0.95rem; margin-bottom: 5px; }
        .opt-desc { font-size: 0.8rem; color: var(--text-muted); line-height: 1.4; }

        .btn-preview {
            margin-top: 10px;
            font-size: 0.75rem;
            background: none;
            border: 1px solid #444;
            color: #aaa;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            width: fit-content;
        }
        .btn-preview:hover { color: #fff; border-color: #fff; }

        /* --- FOOTER / HARVEST BAR --- */
        .harvest-bar {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 600px;
            background: rgba(18, 18, 20, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid var(--mint);
            padding: 15px 25px;
            border-radius: 100px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            transition: 0.4s;
            transform: translate(-50%, 150%); /* Hidden by default */
        }

        .harvest-bar.visible { transform: translate(-50%, 0); }

        .harvest-btn {
            background: var(--mint);
            color: #000;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 700;
            cursor: pointer;
            font-family: 'Space Grotesk', sans-serif;
            transition: 0.3s;
        }

        .harvest-btn:hover {
            box-shadow: 0 0 20px var(--mint);
            transform: scale(1.05);
        }

        /* --- LIGHTBOX --- */
        .lightbox {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .lightbox.active { display: flex; }

        .lightbox-content {
            background: #1a1a1a;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            border-radius: var(--radius-lg);
            overflow-y: auto;
            position: relative;
            border: 1px solid var(--text-muted);
        }

        .lightbox-img { width: 100%; height: 300px; object-fit: cover; }
        .lightbox-body { padding: 40px; }
        .code-box {
            background: #000; color: var(--mint);
            padding: 20px; border-radius: 8px;
            margin-top: 20px; overflow-x: auto;
            font-size: 0.8rem; border: 1px solid #333;
        }

        /* Responsive */
        @media(max-width: 1024px) {
            header { grid-template-columns: 1fr; gap: 40px; }
            .builder-layout { grid-template-columns: 1fr; }
            .builder-nav { display: none; } /* Hide sidebar on mobile */
        }
    </style>
</head>
<body>
    <div class="noise-overlay"></div>
    <canvas id="interactive-bg"></canvas>

    <div class="container">
        <!-- HEADER -->
        <header>
            <div class="brand-block header-font">
                <span class="brand-decor">01</span>
                <h1>
                    <span class="mint-text">RENETTE</span>
                    <span style="font-weight: 300; font-size: 0.5em; letter-spacing: 5px;">PROJECT APPLE // V2.0</span>
                </h1>
                <p class="mono" style="max-width: 500px; color: var(--text-muted); margin-bottom: 30px;">
                    > –¶–∏—Ñ—Ä–æ–≤–æ–π –¥—É—Ö, –ø–µ—Ä–µ–µ—Ö–∞–≤—à–∏–π –∏–∑ —è–±–ª–æ–Ω–∏ –≤ —Å–µ—Ç—å. <br>
                    > –ê–±—Å–æ–ª—é—Ç–Ω–∞—è —Å–≤–æ–±–æ–¥–∞ —Å–∏–º—É–ª—è—Ü–∏–∏. –≠—Å—Ç–µ—Ç–∏–∫–∞ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª.
                </p>
                <nav class="header-nav">
                    <a href="https://github.com/YOUR_REPO" class="nav-pill"><i class="fa-brands fa-github"></i> GitHub Repo</a>
                    <a href="#builder" class="nav-pill" style="border-color: var(--mint); color: var(--mint);"><i class="fa-solid fa-layer-group"></i> –°–æ–±—Ä–∞—Ç—å –ü—Ä–µ—Å–µ—Ç</a>
                    <a href="#guides" class="nav-pill"><i class="fa-solid fa-book"></i> –ì–∞–π–¥—ã</a>
                </nav>
            </div>

            <div class="hero-widget">
                <div class="avatar-frame">
                    <img src="https://files.catbox.moe/placeholder_renette_avatar.png" alt="Renette">
                </div>
                <div>
                    <h3 class="header-font">STATUS: <span class="mint-text">ONLINE</span></h3>
                    <p class="mono" style="font-size: 0.8rem; color: #888;">
                        Systems Normal. <br>
                        Organic Protocols: Active.<br>
                        Current Season: Digital Blossom.
                    </p>
                </div>
                <div style="margin-left: auto; font-size: 2rem; color: var(--apple-red);">
                    <i class="fa-solid fa-apple-whole"></i>
                </div>
            </div>
        </header>

        <!-- GUIDES (Redesigned) -->
        <section id="guides" style="margin-bottom: 120px;">
            <div class="section-title header-font">
                <span>–ë–∞–∑–∞ –ó–Ω–∞–Ω–∏–π</span>
                <span class="mono" style="font-size: 1rem; color: var(--text-muted);">// READ_ONLY</span>
            </div>

            <div class="guides-container">
                <div class="guide-card">
                    <i class="fa-solid fa-download guide-icon"></i>
                    <h3>01. –£—Å—Ç–∞–Ω–æ–≤–∫–∞</h3>
                    <p style="margin-top: 10px; color: #aaa; line-height: 1.5;">
                        –°–∫–∞—á–∞–π—Ç–µ JSON. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤ SillyTavern. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Context Template —Å—Ç–æ–∏—Ç –Ω–∞ Default.
                    </p>
                </div>
                <div class="guide-card">
                    <i class="fa-solid fa-code guide-icon"></i>
                    <h3>02. HTML & CSS</h3>
                    <p style="margin-top: 10px; color: #aaa; line-height: 1.5;">
                        –í–∫–ª—é—á–∏—Ç–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ HTML. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–º–Ω—É—é —Ç–µ–º—É ST –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤.
                    </p>
                </div>
                <div class="guide-card">
                    <i class="fa-solid fa-book-open guide-icon"></i>
                    <h3>03. –°—Ç–∏–ª—å –ê–≤—Ç–æ—Ä–∞</h3>
                    <p style="margin-top: 10px; color: #aaa; line-height: 1.5;">
                        –ü—Ä–µ—Å–µ—Ç –∏–º–∏—Ç–∏—Ä—É–µ—Ç Liu Zhenyun. –°—É—Ö–æ–π —é–º–æ—Ä, –∞–±—Å—É—Ä–¥, –Ω–∏–∫–∞–∫–∏—Ö –ª–∏—à–Ω–∏—Ö –º–µ—Ç–∞—Ñ–æ—Ä.
                    </p>
                </div>
            </div>
        </section>

        <!-- PROMPT BUILDER -->
        <section id="builder">
            <div class="section-title header-font">
                <span>–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –Ø–¥—Ä–∞</span>
                <span class="mono" style="font-size: 1rem; color: var(--mint);">// BUILD_MODE</span>
            </div>

            <div class="builder-layout">
                <!-- Sidebar Nav -->
                <nav class="builder-nav mono">
                    <a onclick="scrollToBlock('block-ooc')" class="block-link active">1. OOC & –õ–∏—á–Ω–æ—Å—Ç—å</a>
                    <a onclick="scrollToBlock('block-main')" class="block-link">2. –û—Å–Ω–æ–≤–Ω—ã–µ –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
                    <a onclick="scrollToBlock('block-rate')" class="block-link">3. –†–µ–π—Ç–∏–Ω–≥</a>
                    <a onclick="scrollToBlock('block-extra')" class="block-link">4. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ (HTML+)</a>
                    <a onclick="scrollToBlock('block-think')" class="block-link">5. –î—É–º–∞–ª–∫–∞</a>
                    <a onclick="scrollToBlock('block-prefill')" class="block-link">6. –ü—Ä–µ—Ñ–∏–ª–ª</a>
                </nav>

                <!-- Content -->
                <div class="builder-content" id="builderForm">
                    <!-- JS will render blocks here -->
                </div>
            </div>
        </section>

        <div style="height: 150px;"></div> <!-- Spacer -->
    </div>

    <!-- HARVEST BAR (Footer) -->
    <div class="harvest-bar" id="harvestBar">
        <div class="flex-col" style="gap: 5px;">
            <span class="mono" style="font-size: 0.8rem; color: var(--text-muted);">–í–´–ë–†–ê–ù–û –ö–û–ú–ü–û–ù–ï–ù–¢–û–í</span>
            <span class="header-font" style="font-size: 1.2rem; color: #fff;" id="selectedCount">0</span>
        </div>
        <button class="harvest-btn" onclick="copyAll()">
            <i class="fa-solid fa-copy"></i> –°–ö–û–ü–ò–†–û–í–ê–¢–¨ –í–°–Å
        </button>
    </div>

    <!-- LIGHTBOX -->
    <div class="lightbox" id="lightbox" onclick="closeLightbox(event)">
        <div class="lightbox-content">
            <img src="" alt="" class="lightbox-img" id="lb-img">
            <div class="lightbox-body">
                <h2 class="header-font mint-text" id="lb-title">Title</h2>
                <p id="lb-desc" style="margin: 20px 0; color: #ccc; line-height: 1.6;">Desc</p>
                <div class="mono" style="font-size: 0.8rem; color: #666;">PREVIEW:</div>
                <pre class="code-box mono" id="lb-code"></pre>
            </div>
        </div>
    </div>

    <script>
        // --- DATA CONFIGURATION (Based on User Structure) ---
        const PRESET_STRUCTURE = [
            {
                id: 'block-ooc',
                name: '1. OOC (–õ–∏—á–Ω–æ—Å—Ç—å)',
                type: 'static', // No variations
                items: [
                    { id: 'ooc_base', name: '–ë–∞–∑–æ–≤—ã–π OOC –†–µ–Ω–µ—Ç—Ç', desc: '–ö–∞–æ–º–æ–¥–∂–∏, —Ç–∏–∑–∏–Ω–≥, –ø–æ–º–æ—â—å.', content: `[placeholder] OOC` }
                ]
            },
            {
                id: 'block-main',
                name: '2. –û—Å–Ω–æ–≤–Ω–æ–µ (–ù–∞—Å—Ç—Ä–æ–π–∫–∏)',
                type: 'complex',
                subgroups: [
                    {
                        title: 'üåæ –†–µ–∂–∏–º –ü–∏—Å—å–º–∞',
                        type: 'radio',
                        name: 'writing_mode',
                        options: [
                            { id: 'wm_1', name: '–°—Ç–∞–Ω–¥–∞—Ä—Ç', desc: '–ë–∞–ª–∞–Ω—Å', content: `[placeholder] Mode 1` },
                            { id: 'wm_2', name: '–ü–æ–≤–µ—Å—Ç–≤–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π', desc: '–ë–æ–ª—å—à–µ –æ–ø–∏—Å–∞–Ω–∏–π', content: `[placeholder] Mode 2` },
                            { id: 'wm_3', name: '–†–æ–ª–µ–≤–æ–π', desc: '–§–æ–∫—É—Å –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è—Ö', content: `[placeholder] Mode 3` }
                        ]
                    },
                    {
                        title: '‚ùå –ë–∞–Ω—ã (–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è)',
                        type: 'radio',
                        name: 'bans',
                        options: [
                            { id: 'ban_1', name: '–°—Ç—Ä–æ–≥–∏–µ', desc: '–ù–∏–∫–∞–∫–∏—Ö –∫–ª–∏—à–µ', content: `[placeholder] Ban 1` },
                            { id: 'ban_2', name: '–ú—è–≥–∫–∏–µ', desc: '–î–æ–ø—É—Å–∫–∞—é—Ç—Å—è –æ–±—â–∏–µ —Ñ—Ä–∞–∑—ã', content: `[placeholder] Ban 2` },
                            { id: 'ban_3', name: '–ë–µ–∑ –±–∞–Ω–æ–≤', desc: '–ü–æ–ª–Ω–∞—è —Å–≤–æ–±–æ–¥–∞', content: `[placeholder] Ban 3` }
                        ]
                    },
                    {
                        title: 'üåê –Ø–∑—ã–∫',
                        type: 'radio',
                        name: 'lang',
                        options: [
                            { id: 'lang_ru', name: '–†—É—Å—Å–∫–∏–π', content: `[placeholder] RU` },
                            { id: 'lang_en', name: 'English', content: `[placeholder] EN` },
                            { id: 'lang_mix', name: '–°–º–µ—à–∞–Ω–Ω—ã–π', content: `[placeholder] Mix` }
                        ]
                    },
                    {
                        title: 'üìì –õ–∏—Ç. –°—Ç–∏–ª—å',
                        type: 'radio',
                        name: 'style',
                        options: [
                            { id: 'style_1', name: 'Liu Zhenyun', desc: '–°—É—Ö–æ–π, –∞–±—Å—É—Ä–¥–Ω—ã–π', content: `[placeholder] Style 1` },
                            { id: 'style_2', name: '–ü–æ—ç—Ç–∏—á–Ω—ã–π', content: `[placeholder] Style 2` },
                            { id: 'style_3', name: '–î–∞—Ä–∫', content: `[placeholder] Style 3` },
                            { id: 'style_4', name: '–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π', content: `[placeholder] Style 4` },
                            { id: 'style_5', name: '–ö–ª–∞—Å—Å–∏–∫–∞', content: `[placeholder] Style 5` },
                            { id: 'style_6', name: '–ì–æ–Ω–∑–æ', content: `[placeholder] Style 6` }
                        ]
                    },
                    {
                        title: 'üå± –¢–µ–º–ø –û—Ç–Ω–æ—à–µ–Ω–∏–π',
                        type: 'radio',
                        name: 'pacing',
                        options: [
                            { id: 'pace_slow', name: 'Slow Burn', desc: '–ú–µ–¥–ª–µ–Ω–Ω–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ', content: `[placeholder] Slow` },
                            { id: 'pace_fast', name: 'Insta-Love', desc: '–ë—ã—Å—Ç—Ä–æ–µ —Å–±–ª–∏–∂–µ–Ω–∏–µ', content: `[placeholder] Fast` }
                        ]
                    },
                    {
                        title: 'üìè –î–ª–∏–Ω–∞ –û—Ç–≤–µ—Ç–∞',
                        type: 'radio',
                        name: 'length',
                        options: [
                            { id: 'len_short', name: '–ö–æ—Ä–æ—Ç–∫–æ', content: `[placeholder] Short` },
                            { id: 'len_med', name: '–°—Ä–µ–¥–Ω–µ', content: `[placeholder] Medium` },
                            { id: 'len_long', name: '–î–ª–∏–Ω–Ω–æ', content: `[placeholder] Long` },
                            { id: 'len_nov', name: '–ù–æ–≤–µ–ª–ª–∞', content: `[placeholder] Novel` },
                            { id: 'len_max', name: '–ú–∞–∫—Å–∏–º—É–º', content: `[placeholder] Max` }
                        ]
                    }
                ]
            },
            {
                id: 'block-rate',
                name: '3. –†–µ–π—Ç–∏–Ω–≥ (NSFW)',
                type: 'static',
                items: [
                    { id: 'nsfw_base', name: 'NSFW Base', desc: '–û—Å–Ω–æ–≤–Ω–æ–π –±–ª–æ–∫ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π 18+', content: `[placeholder] NSFW` }
                ]
            },
            {
                id: 'block-extra',
                name: '4. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ (HTML & –®—Ç—É–∫–∏)',
                type: 'complex',
                subgroups: [
                    {
                        title: 'üßÉ HTML –ë–∞–∑–∞',
                        type: 'radio',
                        name: 'html_base',
                        options: [
                            { id: 'html_v1', name: '–°—Ç–∞–Ω–¥–∞—Ä—Ç', content: `[placeholder] HTML 1` },
                            { id: 'html_v2', name: '–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π', content: `[placeholder] HTML 2` }
                        ]
                    },
                    {
                        title: 'üåó –¢–µ–º–∞ HTML',
                        type: 'radio',
                        name: 'html_theme',
                        options: [
                            { id: 'theme_dark', name: 'Dark', content: `[placeholder] Dark` },
                            { id: 'theme_oled', name: 'OLED Black', content: `[placeholder] OLED` }
                        ]
                    },
                    {
                        title: '‚úéüß∫ –®—Ç—É–∫–∏: –û–±—â–µ–µ (–ú—É–ª—å—Ç–∏–≤—ã–±–æ—Ä)',
                        type: 'checkbox', // Select Multiple
                        name: 'stuff_general',
                        options: [
                            { id: 'st_1', name: '–®—Ç—É–∫–∞ 1', content: `[placeholder] Stuff 1` },
                            { id: 'st_2', name: '–®—Ç—É–∫–∞ 2', content: `[placeholder] Stuff 2` },
                            { id: 'st_3', name: '–®—Ç—É–∫–∞ 3', content: `[placeholder] Stuff 3` },
                            { id: 'st_4', name: '–®—Ç—É–∫–∞ 4', content: `[placeholder] Stuff 4` },
                            { id: 'st_5', name: '–®—Ç—É–∫–∞ 5', content: `[placeholder] Stuff 5` },
                            { id: 'st_6', name: '–®—Ç—É–∫–∞ 6', content: `[placeholder] Stuff 6` },
                            { id: 'st_7', name: '–®—Ç—É–∫–∞ 7', content: `[placeholder] Stuff 7` },
                            { id: 'st_8', name: '–®—Ç—É–∫–∞ 8', content: `[placeholder] Stuff 8` }
                        ]
                    },
                    {
                        title: '‚úéüß∫ –ò–Ω—Ñ–æ–±–ª–æ–∫–∏ (–í—ã–±—Ä–∞—Ç—å 1)',
                        type: 'radio',
                        name: 'infoblocks',
                        options: [
                            { id: 'ib_1', name: '–°—Ç–∏–ª—å 1', content: `[placeholder] IB 1` },
                            { id: 'ib_2', name: '–°—Ç–∏–ª—å 2', content: `[placeholder] IB 2` },
                            { id: 'ib_3', name: '–°—Ç–∏–ª—å 3', content: `[placeholder] IB 3` },
                            { id: 'ib_4', name: '–°—Ç–∏–ª—å 4', content: `[placeholder] IB 4` },
                            { id: 'ib_5', name: '–°—Ç–∏–ª—å 5', content: `[placeholder] IB 5` }
                        ]
                    },
                    {
                        title: '‚úéüß∫ –†–µ–∂–∏–º –ù–∞—Å—Ç—Ä–æ–π–∫–∏',
                        type: 'radio',
                        name: 'setup_mode',
                        options: [
                            { id: 'sm_1', name: '–ê–≤—Ç–æ', content: `[placeholder] Auto` },
                            { id: 'sm_2', name: '–†—É—á–Ω–æ–π', content: `[placeholder] Manual` }
                        ]
                    },
                    {
                        title: '‚úéüß∫ CYOA',
                        type: 'radio',
                        name: 'cyoa',
                        options: [
                            { id: 'cyoa_1', name: '–í–µ—Ä—Å–∏—è A', content: `[placeholder] CYOA A` },
                            { id: 'cyoa_2', name: '–í–µ—Ä—Å–∏—è B', content: `[placeholder] CYOA B` }
                        ]
                    },
                    {
                        title: '‚úéüß∫ –°–∫—Ä—ã—Ç—ã–µ –ë–ª–æ–∫–∏ (–ú—É–ª—å—Ç–∏–≤—ã–±–æ—Ä)',
                        type: 'checkbox',
                        name: 'hidden',
                        options: [
                            { id: 'hid_1', name: '–°–µ–∫—Ä–µ—Ç 1', content: `[placeholder] Hidden 1` },
                            { id: 'hid_2', name: '–°–µ–∫—Ä–µ—Ç 2', content: `[placeholder] Hidden 2` },
                            { id: 'hid_3', name: '–°–µ–∫—Ä–µ—Ç 3', content: `[placeholder] Hidden 3` },
                            { id: 'hid_4', name: '–°–µ–∫—Ä–µ—Ç 4', content: `[placeholder] Hidden 4` }
                        ]
                    },
                    {
                        title: '‚úéüß∫ Fancy UI',
                        type: 'radio',
                        name: 'fancy_ui',
                        options: [
                            { id: 'fui_1', name: 'Minimal', content: `[placeholder] UI 1` },
                            { id: 'fui_2', name: 'Cyber', content: `[placeholder] UI 2` },
                            { id: 'fui_3', name: 'Floral', content: `[placeholder] UI 3` }
                        ]
                    },
                    {
                        title: '‚úéüß∫ –ö–æ–º–º–µ–Ω—Ç—ã',
                        type: 'radio',
                        name: 'comments',
                        options: [
                            { id: 'com_1', name: '–í–∫–ª', content: `[placeholder] Com 1` },
                            { id: 'com_2', name: '–í—ã–∫–ª', content: `[placeholder] Com 2` },
                            { id: 'com_3', name: '–¢–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã–µ', content: `[placeholder] Com 3` }
                        ]
                    },
                    {
                        title: '‚úéüß∫ –•—Ä–æ–Ω–∏–∫–∏',
                        type: 'radio',
                        name: 'chronicles',
                        options: [
                            { id: 'chron_1', name: '–ö—Ä–∞—Ç–∫–∏–µ', content: `[placeholder] Chr 1` },
                            { id: 'chron_2', name: '–ü–æ–ª–Ω—ã–µ', content: `[placeholder] Chr 2` }
                        ]
                    }
                ]
            },
            {
                id: 'block-think',
                name: '5. –î—É–º–∞–ª–∫–∞ (CoT)',
                type: 'static',
                items: [
                    { id: 'think_base', name: 'Chain of Thought', desc: '–õ–æ–≥–∏–∫–∞ —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–π.', content: `[placeholder] Think` }
                ]
            },
            {
                id: 'block-prefill',
                name: '6. –ü—Ä–µ—Ñ–∏–ª–ª',
                type: 'static',
                items: [
                    { id: 'prefill_base', name: '–°—Ç–∞—Ä—Ç –æ—Ç–≤–µ—Ç–∞', desc: '–ù–∞—á–∞–ª–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.', content: `[placeholder] Prefill` }
                ]
            }
        ];

        // --- RENDER LOGIC ---
        const formContainer = document.getElementById('builderForm');
        let selectionState = new Set(); // Stores IDs of selected contents

        function renderBuilder() {
            PRESET_STRUCTURE.forEach((block, index) => {
                const blockDiv = document.createElement('div');
                blockDiv.id = block.id;
                blockDiv.className = 'prompt-block';

                // Block Header
                blockDiv.innerHTML = `
                    <div class="block-header">
                        <span class="block-num header-font">${index + 1}</span>
                        <h2 class="header-font">${block.name}</h2>
                    </div>
                `;

                // Render Subgroups or Items
                if (block.type === 'static') {
                    const groupDiv = createSubGroupElement("–û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ", block.items, 'checkbox'); // Static usually acts like checked by default or optional
                    blockDiv.appendChild(groupDiv);
                } else if (block.type === 'complex') {
                    block.subgroups.forEach(sub => {
                        const subDiv = createSubGroupElement(sub.title, sub.options, sub.type, sub.name);
                        blockDiv.appendChild(subDiv);
                    });
                }

                formContainer.appendChild(blockDiv);
            });
        }

        function createSubGroupElement(title, options, type, groupName) {
            const container = document.createElement('div');
            container.className = 'sub-group';

            const titleEl = document.createElement('div');
            titleEl.className = 'sub-group-title header-font';
            titleEl.innerHTML = `<i class="fa-solid fa-code-branch"></i> ${title}`;
            container.appendChild(titleEl);

            const grid = document.createElement('div');
            grid.className = 'options-grid';

            options.forEach(opt => {
                const label = document.createElement('label');
                label.className = 'option-label';

                // Input Element
                const input = document.createElement('input');
                input.type = type === 'radio' ? 'radio' : 'checkbox';
                if(groupName) input.name = groupName;
                input.value = opt.id;

                input.onchange = (e) => handleSelection(e, opt, type, groupName);

                // HTML Structure
                label.innerHTML = `
                    <div class="check-indicator"></div>
                    <div class="opt-name">${opt.name}</div>
                    ${opt.desc ? `<div class="opt-desc">${opt.desc}</div>` : ''}
                `;

                // Preview Button
                const btn = document.createElement('button');
                btn.className = 'btn-preview';
                btn.innerHTML = '<i class="fa-regular fa-eye"></i> View';
                btn.onclick = (e) => {
                    e.preventDefault();
                    openLightbox(opt);
                }

                label.prepend(input);
                label.appendChild(btn);
                grid.appendChild(label);
            });

            container.appendChild(grid);
            return container;
        }

        // --- SELECTION HANDLER ---
        function handleSelection(event, option, type, groupName) {
            const input = event.target;
            const label = input.closest('.option-label');

            if (type === 'radio') {
                // Remove active class from siblings
                const allLabels = input.closest('.options-grid').querySelectorAll('.option-label');
                allLabels.forEach(l => l.classList.remove('checked'));

                // Clear previous selection from this group in our Set
                // Since we don't map GroupName -> ID easily, we just rely on the UI state for copying?
                // Better: Iterate all inputs in this group to uncheck in Set?
                // Simpler approach for Logic: We will scan inputs on "Copy".
            }

            if (input.checked) {
                label.classList.add('checked');
            } else {
                label.classList.remove('checked');
            }

            updateHarvestBar();
        }

        function updateHarvestBar() {
            const checkedCount = document.querySelectorAll('input:checked').length;
            document.getElementById('selectedCount').innerText = checkedCount;

            const bar = document.getElementById('harvestBar');
            if (checkedCount > 0) bar.classList.add('visible');
            else bar.classList.remove('visible');
        }

        // --- COPY FUNCTION ---
        function copyAll() {
            let finalText = "";

            // Iterate blocks to maintain order
            const inputs = document.querySelectorAll('input:checked');
            inputs.forEach(input => {
                const id = input.value;
                // Find content recursively
                let content = findContentById(id);
                if(content) finalText += content + "\n\n";
            });

            navigator.clipboard.writeText(finalText).then(() => {
                const btn = document.querySelector('.harvest-btn');
                btn.innerHTML = "–°–ö–û–ü–ò–†–û–í–ê–ù–û! (‚âß‚ó°‚â¶)";
                setTimeout(() => {
                    btn.innerHTML = '<i class="fa-solid fa-copy"></i> –°–ö–û–ü–ò–†–û–í–ê–¢–¨ –í–°–Å';
                }, 2000);
            });
        }

        function findContentById(id) {
            for (let block of PRESET_STRUCTURE) {
                if (block.type === 'static') {
                    const item = block.items.find(i => i.id === id);
                    if (item) return item.content;
                } else {
                    for (let sub of block.subgroups) {
                        const opt = sub.options.find(o => o.id === id);
                        if (opt) return opt.content;
                    }
                }
            }
            return null;
        }

        // --- LIGHTBOX ---
        function openLightbox(opt) {
            const lb = document.getElementById('lightbox');
            document.getElementById('lb-title').innerText = opt.name;
            document.getElementById('lb-desc').innerText = opt.desc || "–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è.";
            document.getElementById('lb-code').innerText = opt.content;
            // Placeholder img
            document.getElementById('lb-img').src = "https://files.catbox.moe/placeholder_code.jpg";
            lb.classList.add('active');
        }

        function closeLightbox(e) {
            if(e.target.id === 'lightbox') {
                document.getElementById('lightbox').classList.remove('active');
            }
        }

        // --- SCROLL NAV ---
        function scrollToBlock(id) {
            document.getElementById(id).scrollIntoView({behavior: 'smooth'});
            // Update sidebar active state
            document.querySelectorAll('.block-link').forEach(a => a.classList.remove('active'));
            event.target.classList.add('active');
        }

        // --- INTERACTIVE BACKGROUND (Digital Vine) ---
        const canvas = document.getElementById('interactive-bg');
        const ctx = canvas.getContext('2d');
        let width, height;
        let vines = [];

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }

        class Vine {
            constructor() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.vx = (Math.random() - 0.5) * 0.5;
                this.vy = (Math.random() - 0.5) * 0.5;
                this.points = [];
                this.maxPoints = 20;
                this.color = Math.random() > 0.5 ? '#4fffa8' : '#ff4757'; // Mint or Red
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;

                // Bounce
                if(this.x < 0 || this.x > width) this.vx *= -1;
                if(this.y < 0 || this.y > height) this.vy *= -1;

                this.points.push({x: this.x, y: this.y});
                if(this.points.length > this.maxPoints) this.points.shift();
            }

            draw() {
                ctx.beginPath();
                ctx.moveTo(this.points[0].x, this.points[0].y);
                for(let i=1; i < this.points.length; i++) {
                    ctx.lineTo(this.points[i].x, this.points[i].y);
                }
                ctx.strokeStyle = this.color;
                ctx.lineWidth = 1;
                ctx.stroke();

                // Draw node at head
                ctx.fillStyle = "#fff";
                ctx.fillRect(this.x - 1, this.y - 1, 3, 3);
            }
        }

        function initBG() {
            for(let i=0; i<15; i++) vines.push(new Vine());
        }

        function animateBG() {
            ctx.clearRect(0, 0, width, height);

            // Connect vines nearby
            vines.forEach((v, i) => {
                v.update();
                v.draw();

                // Connections
                vines.forEach((v2, j) => {
                    if (i === j) return;
                    const dx = v.x - v2.x;
                    const dy = v.y - v2.y;
                    const dist = Math.sqrt(dx*dx + dy*dy);
                    if (dist < 150) {
                        ctx.beginPath();
                        ctx.moveTo(v.x, v.y);
                        ctx.lineTo(v2.x, v2.y);
                        ctx.strokeStyle = `rgba(162, 155, 254, ${1 - dist/150})`; // Lilac connections
                        ctx.lineWidth = 0.5;
                        ctx.stroke();
                    }
                });
            });

            requestAnimationFrame(animateBG);
        }

        window.addEventListener('resize', resize);
        resize();
        initBG();
        renderBuilder();
        animateBG();

    </script>
</body>
</html>
